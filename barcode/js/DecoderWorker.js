function CropTable(e,a,r,t){if(r-e<Image.width&&r-e>0&&(Image.table=Image.table.slice(e,r)),t-a<Image.height&&t-a>0)for(var n=0;n<Image.table.length;n++)Image.table[n]=Image.table[n].slice(a,t);Image.width===Image.table.length&&Image.height===Image.table[0].length||(Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData())}function Log(e){postMessage({result:e,success:"log"})}function flipTable(){for(var e=0;e<Image.table.length;e++)Image.table[e].reverse();Image.table.reverse(),CreateImageData()}function rotateTableRight(){for(var e=[],a=[],r=Image.table[0].length-1;r>=0;r--){a=[];for(var t=0;t<Image.table.length;t++)a.push(Image.table[t][r]);e.push(a)}Image.table=e,Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData()}function rotateTableLeft(){for(var e=[],a=[],r=0;r<Image.table[0].length;r++){a=[];for(var t=Image.table.length-1;t>=0;t--)a.push(Image.table[t][r]);e.push(a)}Image.table=e,Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData()}function RemoveDist(){for(var e,a=0,r=0,t=[],n=0;n<Image.height;n++){a=0,r=0;for(var i=0;i<Image.width;i++)if((Image.table[i][n][0]+Image.table[i][n][1]+Image.table[i][n][2])/3<100){do if(r++,i++,i>=Image.width)break;while((Image.table[i][n][0]+Image.table[i][n][1]+Image.table[i][n][2])/3<100);if(i<Image.width){e=(Image.table[i][n][0]+Image.table[i][n][1]+Image.table[i][n][2])/3;do if(a++,i++,i>=Image.width){a=0;break}while((Image.table[i][n][0]+Image.table[i][n][1]+Image.table[i][n][2])/3>e)}a>4*r?t.push(i):t.push(0),i=Image.width}}r=0;for(var o=0;o<t.length;o++)r+=t[o];r/=t.length,r>20&&CropTable(Math.floor(r),0,Image.width,Image.height)}function verticalAreas(){dataCopy=new Uint8ClampedArray(Image.data),LowLight?contrastBinary(dataCopy):(contrast(dataCopy,250),binary(dataCopy,100));for(var e,a,r=4*Image.width*Math.round(Image.height/2),t=[],n=r;n<r+4*Image.width;n+=4)if(0===dataCopy[n]){e=n;break}for(var i,o=!1,g=e,n=e;n<r+4*Image.width;n+=4)if(255===dataCopy[n]){if(a++,0==o&&(i=n,o=!0),a>30){for(g-r>40&&(g-=40),t.push([(g-r)/4,(i-r)/4]);255===dataCopy[n]&&n<r+4*Image.width;)n+=4;g=n}}else a=0,o=!1;return t}function InterestAreas(){dataCopy=new Uint8ClampedArray(Image.data),LowLight?contrastBinary(dataCopy):(contrast(dataCopy,250),binary(dataCopy,100));var e=10,a=6,r=0,t=-1;do{do r=HorizontalArea(dataCopy,r,a),e--;while("number"==typeof r&&e);if(r[1]-r[0]<25)a>1&&(r=r[1],a-=.5,e=10);else{if(!(a>1))break;t!==r[0]?(t=r[0],"number"!=typeof r&&allAreas.push(r),r=r[1],a-=.5,e=10):(r=0,a-=.5,e=10)}}while("number"==typeof r)}function CreateImageData(){Image.data=new Uint8ClampedArray(Image.width*Image.height*4);for(var e,a=0;a<Image.height;a++)for(var r=0;r<Image.width;r++)e=4*a*Image.width,Image.data[e+4*r]=Image.table[r][a][0],Image.data[e+4*r+1]=Image.table[r][a][1],Image.data[e+4*r+2]=Image.table[r][a][2],Image.data[e+4*r+3]=Image.table[r][a][3]}function BlackEdges(e){for(var a=0,r=[],t=0;t<Image.height;t++)r.push([255,255,255,255]);for(var n=0;n<Image.width;n++){a=0;for(var i=0;i<Image.height;i++)a+=(Image.table[n][i][0]+Image.table[n][i][1]+Image.table[n][i][2])/3;if(a/=Image.height,!(e>a)){Image.table[n]=r.slice(),Image.table[n+1]=r.slice();break}Image.table[n]=r.slice()}for(var n=Image.width-1;n>=0;n--){a=0;for(var i=0;i<Image.height;i++)a+=(Image.table[n][i][0]+Image.table[n][i][1]+Image.table[n][i][2])/3;if(a/=Image.height,!(e>a))break;Image.table[n]=r.slice()}CreateImageData()}function CreateTable(){Image.table=[];for(var e=[],a=0;a<4*Image.width;a+=4){e=[];for(var r=a;r<Image.data.length;r+=4*Image.width)e.push([Image.data[r],Image.data[r+1],Image.data[r+2],Image.data[r+3]]);Image.table.push(e)}}function EnlargeTable(e,a){for(var r=[],t=0;t<Image.width;t++){r=[];for(var n=0;n<Image.height;n++)for(var i=0;e>i;i++)r.push(Image.table[t][n]);Image.table[t]=r.slice()}r=Image.table.slice();for(var t=0;t<Image.width;t++)for(var i=0;a>i;i++)Image.table[t*a+i]=r[t].slice();Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData()}function ScaleHeight(e){for(var a=[],r=0,t=0,n=0,i=0;i<Image.height-e;i+=e)for(var o=0;o<Image.width;o++){r=0,t=0,n=0;for(var g=i;i+e>g;g++)r+=Image.table[o][g][0],t+=Image.table[o][g][1],n+=Image.table[o][g][2];a.push(r/e),a.push(t/e),a.push(n/e),a.push(255)}return new Uint8ClampedArray(a)}function ImgProcessing(){var e=new Uint8ClampedArray(Image.data);LowLight?contrastBinary(e):(contrast(e,255),binary(e,110));var a=TrimBlack(e);CropTable(a[0],0,a[1],Image.height),allAreas=[];var r,t=Image.table.slice();InterestAreas(),0===allAreas.length&&allAreas.push(averageLines()),Image.height-allAreas[allAreas.length-1][1]>30&&(CropTable(0,allAreas[allAreas.length-1][1],Image.width,Image.height),Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData(),InterestAreas(),Image.table=t.slice(),Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData());var n=[];Image.table=t.slice(),Image.width=Image.table.length,Image.height=Image.table[0].length;for(var i=0;i<allAreas.length;i++)r=allAreas[i],r[1]>Image.height&&(r[1]=Image.height),CropTable(0,r[0],Image.width,r[1]),n.push(Image.table.slice()),Image.table=t.slice(),Image.width=Image.table.length,Image.height=Image.table[0].length;for(var o=n.length,i=0;o>i;i++){Image.table=n[i],Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData();var g=verticalAreas();if(g.length>1){tempSecondTable=Image.table.slice(),CropTable(0,0,g[0][1],Image.height),n[i]=Image.table.slice();for(var h=1;h<g.length;h++)Image.table=tempSecondTable.slice(),Image.width=Image.table.length,Image.height=Image.table[0].length,CropTable(g[h][0],0,g[h][1],Image.height),n.push(Image.table.slice())}}return n}function contrast(e,a){a=Math.max(0,Math.min(255,parseFloat(a)||127));for(var r=[],t=0;256>t;t++){var n=Math.tan(a*Math.PI/180)*(t-127)+127;n>255?n=255:0>n&&(n=0),r[t]=0|n}for(var t=0,i=Image.width*Image.height*4;i>t;t+=4)e[t]=r[e[t]],e[t+1]=r[e[t+1]],e[t+2]=r[e[t+2]]}function binary(e,a){a=Math.max(0,Math.min(255,parseFloat(a)||127));for(var r,t=0,n=Image.width*Image.height*4;n>t;t+=4)r=(e[t]+e[t+1]+e[t+2])/3,a>r?e[t]=e[t+1]=e[t+2]=0:e[t]=e[t+1]=e[t+2]=255,e[t+3]=255}function TrimBlack(e){for(var a=[],r=0,t=0;t<e.length;t+=4){for(var n=t;n<e.length;n+=4*Image.width)r+=e[n];if(r/Image.height>100){a.push(t/4%Image.width);break}r=0}r=0;for(var t=4*Image.width-4;t>0;t-=4){for(var n=t;n<e.length;n+=4*Image.width)r+=e[n];if(r/Image.height>100){a.push(t/4%Image.width);break}r=0}return a}function HorizontalArea(e,a,r){a="undefined"!=typeof a?a:1,a=a>0?a:1;for(var t=0,n=0,i=0,o=4*a*Image.width;o<e.length/r;o+=4*Image.width){for(var g=0;g<4*Image.width;g+=4)i+=e[g+o];if(i/Image.width>230){n=o;break}i=0}var h=0;if(i=0,n)for(var o=n;o<e.length;o+=4*Image.width){for(var g=0;g<4*Image.width;g+=4)0===e[g+o]&&i++;if(i>Image.width/5){t=o;break}i=0}else for(var o=4*a*Image.width;o<e.length;o+=4*Image.width){for(var g=0;g<4*Image.width;g+=4)i+=e[g+o];if(i/Image.width>230){h=o;break}i=0}return n?Math.round(t/4/Image.width):[a,Math.round(h/4/Image.width)]}function averageLines(){for(var e=0,a=[],r=0;r<Image.data.length;r+=4*Image.width){e=0;for(var t=r;t<4*Image.width+r;t+=4)e+=(Image.data[t]+Image.data[t+1]+Image.data[t+2])/3;e/=Image.width,a.push(e)}var n=[];e=0;for(var i=a[0],r=1;r<a.length;r++)Math.abs(a[r]-i)>13&&(n.push([e,r-1]),e=r,i=a[r]);e=0;for(var o=[0,Image.height],r=0;r<n.length;r++)n[r][1]-n[r][0]>e&&(e=n[r][1]-n[r][0],o=n[r]);return o}function Main(){for(var e=ImgProcessing(),a=0,r=0;r<e.length;r++){Image.table=e[r],Image.width=Image.table.length,Image.height=Image.table[0].length,CreateImageData();var t=averageLines();CropTable(0,t[0],Image.width,t[1]),BlackEdges(100),RemoveDist();var n,i=ScaleHeight(30),o=0,g="",h={},l=[];t=!1;do{n=yStraighten(i.subarray(o,o+4*Image.width));for(var c=0;c<FormatPriority.length;c++){if("EAN-13"!=g&&("Code128"==FormatPriority[c]&&(t=BinaryString(n,0),t.string&&(g=t.format,t=t.string)),"Code93"==FormatPriority[c]&&(t=BinaryString(n,1),t&&(g="Code93")),"Code39"==FormatPriority[c]&&(t=BinaryString(n,2),t&&(g="Code39")),"2Of5"!=FormatPriority[c]&&"Inter2Of5"!=FormatPriority[c]||("2Of5"==FormatPriority[c]?(t=BinaryString(n,4),t&&(g="Standard 2 of 5")):(t=BinaryString(n,5),t&&(g="Interleaved 2 of 5")))),"EAN-13"==FormatPriority[c]){var d=BinaryString(n,3);t=d.string,t&&(g="EAN-13","undefined"==typeof h[t]?(h[t]={count:1,correction:d.correction},l.push(t)):(h[t].count=h[t].count+1,h[t].correction=h[t].correction+d.correction),Ean13Speed||(t=!1))}if(t)break}o+=4*Image.width}while(!t&&o<i.length);if(t&&"EAN-13"!=g&&(postMessage({result:[t],success:!0,finished:!1}),a++),"EAN-13"!=g||Ean13Speed||(t=!1),!t){EnlargeTable(4,2),o=0,i=ScaleHeight(20);do{n=yStraighten(i.subarray(o,o+4*Image.width));for(var c=0;c<FormatPriority.length;c++){if("EAN-13"!=g&&("Code128"==FormatPriority[c]&&(t=BinaryString(n,0),t.string&&(g=t.format,t=t.string)),"Code93"==FormatPriority[c]&&(t=BinaryString(n,1),t&&(g="Code93")),"Code39"==FormatPriority[c]&&(t=BinaryString(n,2),t&&(g="Code39")),"2Of5"!=FormatPriority[c]&&"Inter2Of5"!=FormatPriority[c]||("2Of5"==FormatPriority[c]?(t=BinaryString(n,4),t&&(g="Standard 2 of 5")):(t=BinaryString(n,5),t&&(g="Interleaved 2 of 5")))),"EAN-13"==FormatPriority[c]){var d=BinaryString(n,3);t=d.string,t&&(g="EAN-13","undefined"==typeof h[t]?(h[t]={count:1,correction:d.correction},l.push(t)):(h[t].count=h[t].count+1,h[t].correction=h[t].correction+d.correction),Ean13Speed||(t=!1))}if(t)break}o+=4*Image.width}while(!t&&o<i.length);t&&"EAN-13"!=g&&(postMessage({result:[t],success:!0,finished:!1}),a++)}if("EAN-13"==g){var f={};for(var u in h){h[u].correction=h[u].correction/h[u].count;var m=h[u].correction;m-=Ean13Speed?4*h[u].count:h[u].count,m+=l.indexOf(u),f[u]=m}var v=Number.POSITIVE_INFINITY,I="";for(var u in f)f[u]<v&&(v=f[u],I=u);t=11>v?I:!1,t&&(postMessage({result:[t],success:!0,finished:!1}),a++)}if(a>=DecodeNr)break}return[]}function yStraighten(e){for(var a,r=0,t=new Uint8ClampedArray(150*Image.width*4),n=0;n<t.length;n++)t[n]=255;for(var n=0;n<4*Image.width;n+=4){a=180,r=(e[n]+e[n+1]+e[n+2])/3,r+=(e[n+4]+e[n+5]+e[n+6])/3,r/=2;for(var i=n;i<t.length;i+=4*Image.width)a>r&&(t[i]=t[i+1]=t[i+2]=0),a--}return t}function TwoOfFiveStartEnd(e,a){if(e.length<5||e.length>6)return!1;for(var r=[[0,0],[0,0]],t=0;t<e.length;t++){if(e[t]>r[0][0]){r[0][0]=e[t];var n=r[0][1];r[0][1]=t,t=n}e[t]>r[1][0]&&t!=r[0][1]&&(r[1][0]=e[t],r[1][1]=t)}var i=r[0][0]+r[1][0];if(i/=2,r[0][0]/i>1.2||r[0][0]/i<.8)return!1;if(r[1][0]/i>1.2||r[1][0]/i<.8)return!1;for(var o=0,g=0;g<e.length;g++)g!=r[0][1]&&g!=r[1][1]&&(o+=e[g]);o/=e.length-2;for(var g=0;g<e.length;g++)if(g!=r[0][1]&&g!=r[1][1]&&(e[g]/o>1.4||e[g]/o<.6))return!1;return a?!(0!=r[0][1]&&2!=r[0][1]||0!=r[1][1]&&2!=r[1][1]):!(0!=r[0][1]&&4!=r[0][1]||0!=r[1][1]&&4!=r[1][1])}function CheckInterleaved(e,a){for(var r=0,t=0;t<e.length;t++)r+=e[t];if(r/=4,a){if(4!=e.length)return!1;for(var t=0;t<e.length;t++)if(e[t]/r<.8||e[t]/r>1.2)return!1;return!0}if(3!=e.length)return!1;for(var n,i=0,t=0;t<e.length;t++)e[t]>i&&(i=e[t],n=t);if(0!=n)return!1;if(e[0]/r<1.5||e[0]/r>2.5)return!1;for(var t=1;t<e.length;t++)if(e[t]/r<.5||e[t]/r>1.5)return!1;return!0}function contrastBinary(e){for(var a=381,r=384,t=0,n=Image.width*Image.height*4;n>t;t+=4){var i=e[t]+e[t+1]+e[t+2];a>i?a=i:i>r&&(r=i)}for(var o=(r+a)/2,t=0,n=Image.width*Image.height*4;n>t;t+=4)ave=e[t]+e[t+1]+e[t+2],ave<o?e[t]=e[t+1]=e[t+2]=0:e[t]=e[t+1]=e[t+2]=255,e[t+3]=255}function BinaryString(e,a){var r,t,n,i=[],o=[],g=0,h=!1;0==a&&(n=6),1==a&&(n=6),2==a&&(n=9),3==a&&(n=4),4==a&&(n=5),5==a&&(n=10);for(var l=!1,c=255,d=!1,f=0,u=0,m=0;m<e.length-4*Image.width;m+=4*Image.width){var v=e.subarray(m,m+4*Image.width);t=BarLength(v),u=0,0!=a&&4!=a||(t/=2),i=[],r=0,o=[],binTempInter=[],l=!1;for(var I=!1,C=0;C<v.length;C+=4){if(g=0,!l&&0===v[C]){if(l=!0,d=!0,4==a){c=v[C];var s=[0,0,0,0,0,0];do s[g]=s[g]+1,C+=4,c!=v[C]&&(g++,c=v[C]);while(6>g&&C<v.length);if(!TwoOfFiveStartEnd(s,!0))break;g=0}if(5==a){c=v[C];var A=[0,0,0,0];do A[g]=A[g]+1,C+=4,c!=v[C]&&(g++,c=v[C]);while(4>g&&C<v.length);if(!CheckInterleaved(A,!0))break;g=0}}if(l){c=v[C];do{if(g++,C+=4,5==a&&g/t>5){for(var b=[],B=0;B<o.length;B++)b.push(o[B]),B>=binTempInter.length||b.push(binTempInter[B]);if(CheckInterleaved(b,!1))break;i=[];break}if(C>=v.length)break}while(v[C]===c);if(2==a&&h){h=!1;continue}if(4==a&&5==a||(g/=t),5==a?0==c?o.push(g):binTempInter.push(g):o.push(g),r++,4==a&&255==v[C]){var p=0;do if(p++,C+=4,p/t>3){if(TwoOfFiveStartEnd(o,!1))break;i=[];break}while(255==v[C]&&C<v.length)}if(4==a&&C>=v.length-4){do C-=4;while(255==v[C]&&C>=0);c=v[C];var s=[0,0,0,0,0];g=0;do s[g]=s[g]+1,C-=4,c!=v[C]&&(g++,c=v[C]);while(5>g&&C>=0);if(TwoOfFiveStartEnd(s,!1))break;i=[];break}if(3==r&&3==a&&d&&(r=0,o=[],d=!1),r===n){if(3==a&&6==f){f=0,r=0,I&&(n=4),o=[];continue}5!=f||I||(I=!0,n=5),i.push(o),r=0,o=[],5==a&&(i.push(binTempInter),binTempInter=[]),3==a&&f++,2==a&&(h=!0)}if(C-=4,3==a&&i.length>12)break}}if(o=Distribution(i,a),3==a?(i=o.data,u=o.correction):i=o,i.length>4)if(0==a){if(CheckCode128(i)){i=DecodeCode128(i);break}}else if(1==a){if(CheckCode93(i)){i=DecodeCode93(i);break}}else if(2==a){if(CheckCode39(i)){i=DecodeCode39(i);break}}else if(3==a){var w=DecodeEAN13(i);if(w&&13===w.length){i=w;break}}else if(4==a||5==a){var w=Decode2Of5(i);if(w){i=w;break}}}return 0==a?"string"==typeof i.string?i:!1:"string"==typeof i?3==a?{string:i,correction:u}:i:!1}function BarLength(e){for(var a=0,r=0;r<e.length;r+=4)if(0===e[r]){do a++,r+=4;while(0===e[r]);break}return a}function Distribution(e,a){var r,t,n,i=0,o=[];0===a?(t=11,r=6,n=4):1===a?(t=9,r=6,n=4):2===a?(t=12,r=9):3===a&&(t=7,r=4,n=4);for(var g=0;g<e.length;g++){var h=e[g],l=0;l=0;var c=0,d=[],f=[],u=[];if(4!=a&&5!=a){for(;r>c;)l+=h[c],c++;if(2===a){for(var m=[],v=0;3>v;v++){for(var I,C=0,s=0;s<h.length;s++)-1==m.indexOf(s)&&h[s]>C&&(I=s,C=h[s]);u.push(C),m.push(I)}for(var s=0;s<h.length;s++)-1===m.indexOf(s)&&f.push(h[s]);for(var A=0,s=0;s<f.length;s++)A+=f[s];A/=f.length;for(var b=0,s=0;s<u.length;s++)b+=u[s];b/=u.length,n=b/A}for(c=0;r>c;)d.push(h[c]/l*t),c++;for(c=0;r>c;)2==a?d[c]=Math.abs(1-d[c])<Math.abs(n-d[c])?1:2:(d[c]=d[c]>n?n:d[c],d[c]=d[c]<1?1:d[c],d[c]=Math.round(d[c])),c++;if(3==a){for(var B=0,v=0;v<d.length;v++)B+=d[v];if(B>7){for(var C=0,p=0,v=0;v<d.length;v++)d[v]>C&&(C=d[v],p=v);d[p]=C-(B-7)}}if(3==a)for(var v=0;v<d.length;v++)i+=Math.abs(d[v]-h[v]/l*t);o.push(d)}else{for(var C=[[0,0],[0,0]],v=0;v<h.length;v++){if(!isFinite(h[v]))return[];if(h[v]>C[0][0]){C[0][0]=h[v];var w=C[0][1];C[0][1]=v,v=w-1}h[v]>C[1][0]&&v!=C[0][1]&&(C[1][0]=h[v],C[1][1]=v)}if(Secure2Of5){if(wideAvrg=C[0][0]+C[1][0],wideAvrg/=2,C[0][0]/wideAvrg>1.2||C[0][0]/wideAvrg<.8)return[];if(C[1][0]/wideAvrg>1.2||C[1][0]/wideAvrg<.8)return[];narrowAvrg=0;for(var v=0;v<h.length;v++)v!=C[0][1]&&v!=C[1][1]&&(narrowAvrg+=h[v]);narrowAvrg/=3;for(var v=0;v<h.length;v++)if(v!=C[0][1]&&v!=C[1][1]&&(h[v]/narrowAvrg>1.2||h[v]/narrowAvrg<.7))return[]}for(var v=0;v<h.length;v++)v!=C[0][1]&&v!=C[1][1]?d.push(0):d.push(1);o.push(d)}}return 3==a?{data:o,correction:i}:o}function CheckCode128(e){var a=e[e.length-2].join("");a=Code128Encoding.value.indexOf(a);var r=-1!=a,t=Code128Encoding.value.indexOf(e[0].join(""));r=-1===t?!1:r;for(var n=1;n<e.length-2;n++)t+=Code128Encoding.value.indexOf(e[n].join(""))*n,r=-1===Code128Encoding.value.indexOf(e[n].join(""))?!1:r;return t%103===a&&r}function Decode2Of5(e){for(var a="",r=0;r<e.length;r++){if(-1==TwoOfFiveEncoding.indexOf(e[r].join("")))return!1;a+=TwoOfFiveEncoding.indexOf(e[r].join(""))}return a}function DecodeEAN13(e){if(12!=e.length)return!1;for(var a=e.slice(0,6),r=!1,t=e.slice(6,e.length),n=0;n<a.length;n++){for(var e="",i=0;i<a[n][0];i++)e+="0";for(var i=0;i<a[n][1];i++)e+="1";for(var i=0;i<a[n][2];i++)e+="0";for(var i=0;i<a[n][3];i++)e+="1";if(a[n]=e,7!=a[n].length){r=!0;break}}if(r)return!1;for(var n=0;n<t.length;n++){for(var e="",i=0;i<t[n][0];i++)e+="1";for(var i=0;i<t[n][1];i++)e+="0";for(var i=0;i<t[n][2];i++)e+="1";for(var i=0;i<t[n][3];i++)e+="0";if(t[n]=e,7!=t[n].length){r=!0;break}}if(r)return!1;for(var o=[],n=0;n<a.length;n++)if("undefined"!=typeof EAN13Encoding.L[a[n]])o.push("L");else{if("undefined"==typeof EAN13Encoding.G[a[n]]){r=!0;break}o.push("G")}if(r)return!1;var g=[];if("undefined"==typeof EAN13Encoding.formats[o.join("")])return!1;g.push(EAN13Encoding.formats[o.join("")]);for(var n=0;n<a.length;n++){if("undefined"==typeof EAN13Encoding[o[n]][a[n]]){r=!0;break}g.push(EAN13Encoding[o[n]][a[n]])}if(r)return!1;for(var n=0;n<t.length;n++){if("undefined"==typeof EAN13Encoding.R[t[n]]){r=!0;break}g.push(EAN13Encoding.R[t[n]])}if(r)return!1;for(var h=3,l=0,n=g.length-2;n>=0;n--)l+=g[n]*h,h=3==h?1:3;return l=(10-l%10)%10,g[g.length-1]==l?g.join(""):!1}function CheckCode93(e){var a=e[e.length-3].join(""),r=e[e.length-2].join(""),t=!0;if("undefined"==typeof Code93Encoding[a])return!1;if("undefined"==typeof Code93Encoding[r])return!1;for(var n=Code93Encoding[a].value,i=1,o=0,g=e.length-4;g>0&&(t="undefined"==typeof Code93Encoding[e[g].join("")]?!1:t,t);g--)o+=Code93Encoding[e[g].join("")].value*i,i++,i>20&&(i=1);var h=o%47,l=h===n;if(!l)return!1;if(!t)return!1;o=h,i=2,n=Code93Encoding[r].value;for(var g=e.length-4;g>0&&(t="undefined"==typeof Code93Encoding[e[g].join("")]?!1:t,t);g--)o+=Code93Encoding[e[g].join("")].value*i,i++,i>15&&(i=1);var c=o%47,d=c===n;return d&&l}function CheckCode39(e){var a=!0;if("undefined"==typeof Code39Encoding[e[0].join("")])return!1;if("*"!=Code39Encoding[e[0].join("")].character)return!1;if("undefined"==typeof Code39Encoding[e[e.length-1].join("")])return!1;if("*"!=Code39Encoding[e[e.length-1].join("")].character)return!1;for(var r=1;r<e.length-1;r++)if("undefined"==typeof Code39Encoding[e[r].join("")]){a=!1;break}return a}function DecodeCode39(e){for(var a="",r=!1,t="",n="",i=1;i<e.length-1;i++)t=Code39Encoding[e[i].join("")].character,"$"!=t&&"/"!=t&&"+"!=t&&"%"!=t?r?("undefined"==typeof ExtendedEncoding[n+t]?-1!=ExtendedExceptions.indexOf(t)&&(a+=t):a+=ExtendedEncoding[n+t],r=!1):a+=t:(r=!0,n=t);return a}function DecodeCode93(e){for(var a="",r=!1,t="",n="",i=1;i<e.length-3;i++)t=Code93Encoding[e[i].join("")].character,"($)"!=t&&"(/)"!=t&&"(+)"!=t&&"(%)"!=t?r?("undefined"==typeof ExtendedEncoding[n+t]?-1!=ExtendedExceptions.indexOf(t)&&(a+=t):a+=ExtendedEncoding[n+t],r=!1):a+=t:(r=!0,n=t[1]);return a}function DecodeCode128(e){for(var a,r=Code128Encoding[e[0].join("")],t="Code128",n="",i=1;i<e.length-2;i++)switch(a=Code128Encoding[e[i].join("")][r]){case"FNC1":1==i&&(t="GS1-128");case"FNC2":case"FNC3":case"FNC4":break;case"SHIFT_B":i++,n+=Code128Encoding[e[i].join("")].B;break;case"SHIFT_A":i++,n+=Code128Encoding[e[i].join("")].A;break;case"Code_A":r="A";break;case"Code_B":r="B";break;case"Code_C":r="C";break;default:n+=a}return{string:n,format:t}}TwoOfFiveEncoding=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"],Code128Encoding={212222:{A:" ",B:" ",C:"00"},222122:{A:"!",B:"!",C:"01"},222221:{A:'"',B:'"',C:"02"},121223:{A:"#",B:"#",C:"03"},121322:{A:"$",B:"$",C:"04"},131222:{A:"%",B:"%",C:"05"},122213:{A:"&",B:"&",C:"06"},122312:{A:"'",B:"'",C:"07"},132212:{A:"(",B:"(",C:"08"},221213:{A:")",B:")",C:"09"},221312:{A:"*",B:"*",C:"10"},231212:{A:"+",B:"+",C:"11"},112232:{A:",",B:",",C:"12"},122132:{A:"-",B:"-",C:"13"},122231:{A:".",B:".",C:"14"},113222:{A:"/",B:"/",C:"15"},123122:{A:"0",B:"0",C:"16"},123221:{A:"1",B:"1",C:"17"},223211:{A:"2",B:"2",C:"18"},221132:{A:"3",B:"3",C:"19"},221231:{A:"4",B:"4",C:"20"},213212:{A:"5",B:"5",C:"21"},223112:{A:"6",B:"6",C:"22"},312131:{A:"7",B:"7",C:"23"},311222:{A:"8",B:"8",C:"24"},321122:{A:"9",B:"9",C:"25"},321221:{A:":",B:":",C:"26"},312212:{A:";",B:";",C:"27"},322112:{A:"<",B:"<",C:"28"},322211:{A:"=",B:"=",C:"29"},212123:{A:">",B:">",C:"30"},212321:{A:"?",B:"?",C:"31"},232121:{A:"@",B:"@",C:"32"},111323:{A:"A",B:"A",C:"33"},131123:{A:"B",B:"B",C:"34"},131321:{A:"C",B:"C",C:"35"},112313:{A:"D",B:"D",C:"36"},132113:{A:"E",B:"E",C:"37"},132311:{A:"F",B:"F",C:"38"},211313:{A:"G",B:"G",C:"39"},231113:{A:"H",B:"H",C:"40"},231311:{A:"I",B:"I",C:"41"},112133:{A:"J",B:"J",C:"42"},112331:{A:"K",B:"K",C:"43"},132131:{A:"L",B:"L",C:"44"},113123:{A:"M",B:"M",C:"45"},113321:{A:"N",B:"N",C:"46"},133121:{A:"O",B:"O",C:"47"},313121:{A:"P",B:"P",C:"48"},211331:{A:"Q",B:"Q",C:"49"},231131:{A:"R",B:"R",C:"50"},213113:{A:"S",B:"S",C:"51"},213311:{A:"T",B:"T",C:"52"},213131:{A:"U",B:"U",C:"53"},311123:{A:"V",B:"V",C:"54"},311321:{A:"W",B:"W",C:"55"},331121:{A:"X",B:"X",C:"56"},312113:{A:"Y",B:"Y",C:"57"},312311:{A:"Z",B:"Z",C:"58"},332111:{A:"[",B:"[",C:"59"},314111:{A:"\\",B:"\\",C:"60"},221411:{A:"]",B:"]",C:"61"},431111:{A:"^",B:"^",C:"62"},111224:{A:"_",B:"_",C:"63"},111422:{A:"NUL",B:"`",C:"64"},121124:{A:"SOH",B:"a",C:"65"},121421:{A:"STX",B:"b",C:"66"},141122:{A:"ETX",B:"c",C:"67"},141221:{A:"EOT",B:"d",C:"68"},112214:{A:"ENQ",B:"e",C:"69"},112412:{A:"ACK",B:"f",C:"70"},122114:{A:"BEL",B:"g",C:"71"},122411:{A:"BS",B:"h",C:"72"},142112:{A:"HT",B:"i",C:"73"},142211:{A:"LF",B:"j",C:"74"},241211:{A:"VT",B:"k",C:"75"},221114:{A:"FF",B:"l",C:"76"},413111:{A:"CR",B:"m",C:"77"},241112:{A:"SO",B:"n",C:"78"},134111:{A:"SI",B:"o",C:"79"},111242:{A:"DLE",B:"p",C:"80"},121142:{A:"DC1",B:"q",C:"81"},121241:{A:"DC2",B:"r",C:"82"},114212:{A:"DC3",B:"s",C:"83"},124112:{A:"DC4",B:"t",C:"84"},124211:{A:"NAK",B:"u",C:"85"},411212:{A:"SYN",B:"v",C:"86"},421112:{A:"ETB",B:"w",C:"87"},421211:{A:"CAN",B:"x",C:"88"},212141:{A:"EM",B:"y",C:"89"},214121:{A:"SUB",B:"z",C:"90"},412121:{A:"ESC",B:"{",C:"91"},111143:{A:"FS",B:"|",C:"92"},111341:{A:"GS",B:"}",C:"93"},131141:{A:"RS",B:"~",C:"94"},114113:{A:"US",B:"DEL",C:"95"},114311:{A:"FNC3",B:"FNC3",C:"96"},411113:{A:"FNC2",B:"FNC2",C:"97"},411311:{A:"SHIFT_B",B:"SHIFT_A",C:"98"},113141:{A:"Code_C",B:"Code_C",C:"99"},114131:{A:"Code_B",B:"FNC4",C:"Code_B"},311141:{A:"FNC4",B:"Code_A",C:"Code_A"},411131:{A:"FNC1",B:"FNC1",C:"FNC1"},211412:"A",211214:"B",211232:"C",233111:{A:"STOP",B:"STOP",C:"STOP"},value:["212222","222122","222221","121223","121322","131222","122213","122312","132212","221213","221312","231212","112232","122132","122231","113222","123122","123221","223211","221132","221231","213212","223112","312131","311222","321122","321221","312212","322112","322211","212123","212321","232121","111323","131123","131321","112313","132113","132311","211313","231113","231311","112133","112331","132131","113123","113321","133121","313121","211331","231131","213113","213311","213131","311123","311321","331121","312113","312311","332111","314111","221411","431111","111224","111422","121124","121421","141122","141221","112214","112412","122114","122411","142112","142211","241211","221114","413111","241112","134111","111242","121142","121241","114212","124112","124211","411212","421112","421211","212141","214121","412121","111143","111341","131141","114113","114311","411113","411311","113141","114131","311141","411131","211412","211214","211232","233111"]},Code93Encoding={131112:{value:0,character:"0"},111213:{value:1,character:"1"},111312:{value:2,character:"2"},111411:{value:3,character:"3"},121113:{value:4,character:"4"},121212:{value:5,character:"5"},121311:{value:6,character:"6"},111114:{value:7,character:"7"},131211:{value:8,character:"8"},141111:{value:9,character:"9"},211113:{value:10,character:"A"},211212:{value:11,character:"B"},211311:{value:12,character:"C"},221112:{value:13,character:"D"},221211:{value:14,character:"E"},231111:{value:15,character:"F"},112113:{value:16,character:"G"},112212:{value:17,character:"H"},112311:{value:18,character:"I"},122112:{value:19,character:"J"},132111:{value:20,character:"K"},111123:{value:21,character:"L"},111222:{value:22,character:"M"},111321:{value:23,character:"N"},121122:{value:24,character:"O"},131121:{value:25,character:"P"},212112:{value:26,character:"Q"},212211:{value:27,character:"R"},211122:{value:28,character:"S"},211221:{value:29,character:"T"},221121:{value:30,character:"U"},222111:{value:31,character:"V"},112122:{value:32,character:"W"},112221:{value:33,character:"X"},122121:{value:34,character:"Y"},123111:{value:35,character:"Z"},121131:{value:36,character:"-"},311112:{value:37,character:"."},311211:{value:38,character:" "},321111:{value:39,character:"$"},112131:{value:40,character:"/"},113121:{value:41,character:"+"},211131:{value:42,character:"%"},121221:{value:43,character:"($)"},312111:{value:44,character:"(%)"},311121:{value:45,character:"(/)"},122211:{value:46,character:"(+)"},111141:{value:-1,character:"*"}},Code39Encoding={111221211:{value:0,character:"0"},211211112:{value:1,character:"1"},112211112:{value:2,character:"2"},212211111:{value:3,character:"3"},111221112:{value:4,character:"4"},211221111:{value:5,character:"5"},112221111:{value:6,character:"6"},111211212:{value:7,character:"7"},211211211:{value:8,character:"8"},112211211:{value:9,character:"9"},211112112:{value:10,character:"A"},112112112:{value:11,character:"B"},212112111:{value:12,character:"C"},111122112:{value:13,character:"D"},211122111:{value:14,character:"E"},112122111:{value:15,character:"F"},111112212:{value:16,character:"G"},211112211:{value:17,character:"H"},112112211:{value:18,character:"I"},111122211:{value:19,character:"J"},211111122:{value:20,character:"K"},112111122:{value:21,character:"L"},212111121:{value:22,character:"M"},111121122:{value:23,character:"N"},211121121:{value:24,character:"O"},112121121:{value:25,character:"P"},111111222:{value:26,character:"Q"},211111221:{value:27,character:"R"},112111221:{value:28,character:"S"},111121221:{value:29,character:"T"},221111112:{value:30,character:"U"},122111112:{value:31,character:"V"},222111111:{value:32,character:"W"},121121112:{value:33,character:"X"},221121111:{value:34,character:"Y"},122121111:{value:35,character:"Z"},121111212:{value:36,character:"-"},221111211:{value:37,character:"."},122111211:{value:38,character:" "},121212111:{value:39,character:"$"},121211121:{value:40,character:"/"},121112121:{value:41,character:"+"},111212121:{value:42,character:"%"},121121211:{value:-1,character:"*"}},ExtendedEncoding={"/A":"!","/B":'"',"/C":"#","/D":"$","/E":"%","/F":"&","/G":"'","/H":"(","/I":")","/J":"*","/K":"+","/L":",","/O":"/","/Z":":","%F":";","%G":"<","%H":"=","%I":">","%J":"?","%K":"[","%L":"\\","%M":"]","%N":"^","%O":"_","+A":"a","+B":"b","+C":"c","+D":"d","+E":"e","+F":"f","+G":"g","+H":"h","+I":"i","+J":"j","+K":"k","+L":"l","+M":"m","+N":"n","+O":"o","+P":"p","+Q":"q","+R":"r","+S":"s","+T":"t","+U":"u","+V":"v","+W":"w","+X":"x","+Y":"y","+Z":"z","%P":"{","%Q":"|","%R":"|","%S":"~"},ExtendedExceptions=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","-","."],EAN13Encoding={L:{"0001101":0,"0011001":1,"0010011":2,"0111101":3,"0100011":4,"0110001":5,"0101111":6,"0111011":7,"0110111":8,"0001011":9},G:{"0100111":0,"0110011":1,"0011011":2,"0100001":3,"0011101":4,"0111001":5,"0000101":6,"0010001":7,"0001001":8,"0010111":9},R:{1110010:0,1100110:1,1101100:2,1000010:3,1011100:4,1001110:5,1010000:6,1000100:7,1001000:8,1110100:9},formats:{LLLLLL:0,LLGLGG:1,LLGGLG:2,LLGGGL:3,LGLLGG:4,LGGLLG:5,LGGGLL:6,LGLGLG:7,LGLGGL:8,LGGLGL:9}},self.onmessage=function(e){switch(Image={data:new Uint8ClampedArray(e.data.ImageData),width:e.data.Width,height:e.data.Height},FormatPriority=["Code128","Code93","Code39","EAN-13","2Of5","Inter2Of5"],Secure2Of5=!0,Ean13Speed=!0,LowLight=!1,"undefined"!=typeof e.data.LowLight&&(LowLight=e.data.LowLight),"undefined"!=typeof e.data.Ean13Speed&&(Ean13Speed=e.data.Ean13Speed),"undefined"!=typeof e.data.Secure2Of5&&(Secure2Of5=e.data.Secure2Of5),DecodeNr=Number.POSITIVE_INFINITY,"undefined"!=typeof e.data.DecodeNr&&(DecodeNr=e.data.DecodeNr),"undefined"!=typeof e.data.Decode&&(FormatPriority=e.data.Decode),CreateTable(),e.data.cmd){case"flip":flipTable();break;case"right":rotateTableRight();break;case"left":rotateTableLeft();break;case"normal":}Main(),postMessage({result:[],success:!1,finished:!0})};